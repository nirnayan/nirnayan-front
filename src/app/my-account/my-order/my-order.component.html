<app-header></app-header>
<!-- <div style="background-color: rgba(0,0,0,0.5);" class="loading-spinner" id="loader"></div> -->
<ngx-ui-loader [fgsSize]="0" [logoUrl]="'https://nirnayanhealthcare.com/assets/images/logo.png'"></ngx-ui-loader>
<div class="ordTop"><img src="assets/images/ord-banner.png" alt=""></div>
<div class="rcntBook">
  <h3>Recent Booking</h3>
  <div class="rctBk">
    <div class="rctBkBox" *ngFor="let order of oderItem; let j = index">
      <div class="rctBkBoxTp">
        <h2 class="card-title">Booking Id <span style="text-align: center;">{{order.bill_number}}</span></h2>
        <p class="card-text">Booking Date :- <strong>{{order.booking_date | date: 'dd/MM/yyyy'}}</strong></p>
        <div class="save">
          <div class="saveBox">You Saved</div>
          <div class="saveYellowBox">{{order.discount_amount | currency:'INR'}}</div>
        </div>
        <p class="card-text" style="text-align: center;">Paid <span style="text-align: right;">
            {{order.received_amount | currency:'INR'}}</span></p>
      </div> 
      <div class="card-text trnDtl">
        <div class="trnDtlLft">Transaction Details</div>
        <div class="trnDtlMid">&nbsp;</div>
        <!-- <div class="trnDtlRght">{{order.paymentDetails[0]?.trnx_id}}</div> -->
      </div>
      <ul class="list-group list-group-flush">
        <div class="accordion" id="accordionExample">
          <div class="accordion-item" *ngFor="let item of order.patientDetails; let i = index">
            <h2 class="accordion-header" id="headingOne{{item.id}}">
              <button class="accordion-button" type="button" data-bs-toggle="collapse" [attr.data-bs-target]="'#collapseOne'+item.id" aria-expanded="true" [attr.aria-controls]="'collapseOne'+item.id">
                {{item.patientName}}
              </button>
            </h2>
            <div id="collapseOne{{item.id}}" class="accordion-collapse collapse" [attr.aria-labelledby]="'headingOne'+item.id" data-bs-parent="#accordionExample">
              <table class="table">
                <thead>
                  <th>Test Name</th>
                  <th>Amount</th>
                </thead>
                <tbody>
                  <tr *ngFor="let test of item.tests; let i = index">
                    <td>{{test.test_name}}</td>
                    <td>{{test.costAmount}}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <!-- <p class="card-text text-right">Total Paid Amount : <b class="text-success">{{order[0].received_amount}}</b></p> -->
        <!-- <div class="chkTpRow">
          <div class="chkTpCol compl">
            <div class="chkTpColTxt">Test Booked</div>
          </div>
          <div class="chkTpCol compl">
            <div class="chkTpColTxt">Phlebotomist Assigned</div>
          </div>
          <div class="chkTpCol compl">
            <div class="chkTpColTxt">Sample Collected</div>
          </div>
          <div class="chkTpCol compl">
            <div class="chkTpColTxt">Testing Under Proccess</div>
          </div>
          <div class="chkTpCol">
            <div class="chkTpColTxt">Testing Completed</div>
          </div>
        </div> -->
        <div class="progress mt-3" style="width: 40rem;">
          <div 
            class="progress-bar progress-bar-animated bg-success progress-bar-striped active" 
            role="progressbar" 
            [style.width]="order.booking_stage + '%'" 
            aria-valuenow="{{order.booking_stage}}" 
            aria-valuemin="0" 
            aria-valuemax="100">
            <span>{{order.booking_stage}}% Complete</span>
          </div>
        </div>
      </ul>
      <div class="d-flex justify-content-around">
        <button type="button" class="btn trkBotn">Track<img src="assets/images/green-arrow.png" alt=""></button>
        <button type="button" class="btn trkBotn" data-toggle="modal" data-target="#viewOrder" (click)="viewOrder(order.booking_id)">View Order</button>
      </div>
    </div>
  </div>
</div>




<div class="rcntBook ptOrd">
  <h3>Previous Booking <button class="btn saveBox preBook" (click)="pastOrder()">View Previous Bookings</button></h3>
  <div class="rctBk">
    <div class="rctBkBox" *ngFor="let order of pastItem?.bookings">
      <div class="rctBkBoxTp">
        <h2 class="card-title">Booking Id <span style="text-align: center;">{{order.bill_number}}</span></h2>
        <p class="card-text bkk">Booking Date :- <strong _ngcontent-vwg-c135="">{{order.booking_date | date: 'dd/MM/yyyy'}}</strong></p>
        <div class="save">
          <div class="saveBox">You Saved</div>
          <div class="saveYellowBox">{{order.discount_amount | currency:'INR'}}</div>
        </div>
        <p class="card-text" style="text-align: center;">Paid <span style="text-align: right;">{{order.received_amount | currency:'INR'}}</span></p>
      </div>
      <div class="card-text trnDtl">
        <div class="trnDtlLft">Transaction Details</div>
        <div class="trnDtlMid">&nbsp;</div>
        <div class="trnDtlRght">{{order.paymentDetails[0].trnx_id}}</div>
      </div>
      <div class="rtRow">
        <div class="rtRowTxt">Rate Us</div>
        <img src="../../../assets/images/yellow-star.png" alt="">
        <img src="../../../assets/images/yellow-star.png" alt="">
        <img src="../../../assets/images/yellow-star.png" alt="">
        <img src="../../../assets/images/yellow-star.png" alt="">
        <img src="../../../assets/images/yellow-star.png" alt="">
      </div>
      <div class="review"><textarea placeholder="Share your Review..."></textarea></div>
      <div class="trkBotn" style="display: none;">Submit</div>
  </div>
</div>
</div>
<app-footer></app-footer>


<!-- Modal -->
<div class="modal fade" id="viewOrder" tabindex="-1" aria-labelledby="viewOrderLabel" aria-hidden="true">
<div class="modal-dialog">
<div class="modal-content customModal">
  <div class="modal-header">
    <h4 class="modal-title" id="viewOrderLabel">View Order</h4>
    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="container view-order">
      <div class="card">
        <div class="card-header">
          <div class="row">
            <div class="col">
              <h5 class="mb-0">Booking ID</h5>
              <p class="mb-0 mt-2">{{ orderData?.booking_id }}</p>
            </div>
            <div class="col text-end">
              <h5 class="mb-0">Total Order</h5>
              <p class="mb-0 mt-2 price">₹ {{ orderData?.net_amount }}</p>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div *ngFor="let patient of orderData?.patientDetails">
            <div *ngFor="let test of patient.tests" class="test-item">
              <div class="row">
                <div class="col">
                  <h5>{{ test.test_name }}</h5>
                  <p>Test Code: {{ test.test_code }}</p>
                </div>
                <div class="col text-end">
                  <p class="mb-0 price">₹ {{ test.costAmount }}</p>
                </div>
              </div>
            </div>
          </div>
          <div class="mt-4">
            <h5>Bill Details</h5>
            <div class="row">
              <div class="col"><p>Total Test Cost</p></div>
              <div class="col text-end price"><p>₹ {{ orderData?.gross_amount || orderData?.net_amount }}</p></div>
            </div>
            <div class="row">
              <div class="col"><p>Discount</p></div>
              <div class="col text-end price"><p>₹ {{ orderData?.discount_amount }}</p></div>
            </div>
            <div class="row">
              <div class="col"><p>Received Amount</p></div>
              <div class="col text-end price"><p>₹ {{ orderData?.received_amount }}</p></div>
            </div>
            <div class="row">
              <div class="col"><p>Gross Amount</p></div>
              <div class="col text-end price"><p>₹ {{ orderData?.gross_amount }}</p></div>
            </div>
            <div class="row">
              <div class="col"><strong><p>Total Amount</p></strong></div>
              <div class="col text-end price"><strong><p>₹ {{ orderData?.net_amount }}</p></strong></div>
            </div>
          </div>
          <div class="mt-4">
            <h5><strong>Appointment Details</strong></h5>
            <p><strong>Booking ID:</strong> {{ orderData?.booking_id }}</p>
            <p><strong>Payment:</strong> Received</p>
            <p><strong>Address:</strong> {{ orderData?.address?.addressLine_1 }}, {{ orderData?.address?.addressLine_2 }}</p>
            <p><strong>Date and Time:</strong> {{ formatDate(orderData?.booking_date) }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="modal-footer">
    <button type="button" class="btn btn-order" (click)="downloadInvce()">Download Invoice</button>
  </div>
</div>
</div>
</div>